<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>肥牛老师课堂随机抽查</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'KaiTi', serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #000;
      text-align: center;
    }

    h1 {
      font-size: 48px;
      margin-top: 20px;
      font-family: "KaiTi", serif;
      color: black;
    }

    .roller-container {
      margin: 40px auto;
      width: 60%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 64px;
      font-weight: bold;
    }

    .boxed {
      background-color: rgba(255, 255, 255, 0.8);
      border: 3px solid #333;
      border-radius: 15px;
      padding: 20px 40px;
    }

    .student-number {
      flex: 4;
      text-align: right;
      padding-right: 20px;
    }

    .vocab-word {
      flex: 6;
      text-align: left;
      padding-left: 20px;
    }

    .controls {
      margin-top: 40px;
    }

    button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
    }

    input[type=range], input[type=number], select {
      width: 300px;
      margin-left: 20px;
    }

    #vocabMeaning {
      margin-top: 20px;
      font-size: 28px;
      font-weight: normal;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>肥牛老师课堂随机抽查</h1>
  <div class="roller-container">
    <div class="student-number boxed" id="studentNumber">001</div>
    <div class="vocab-word boxed" id="vocabWord">-</div>
  </div>
  <div id="vocabMeaning">点击下方按钮显示中文意思</div>

  <div class="controls">
    <div>
      <label>选择词库：</label>
      <select id="vocabSelect" onchange="loadSelectedWordFile()">
        <option value="">-- 请选择 --</option>
      </select>
    </div>
    <div style="margin-top: 20px;">
      <label>学号范围：</label>
      <input type="number" id="minNum" value="1" min="1" max="999"> 到
      <input type="number" id="maxNum" value="50" min="1" max="999">
    </div>
    <div>
      <button onclick="toggleRoll('number')">随机学号</button>
      <button onclick="toggleRoll('word')">随机单词</button>
      <button onclick="showMeaning()">显示中文意思</button>
    </div>
    <div>
      <label for="speed">滚动速度：</label>
      <input type="range" id="speed" min="1" max="100" value="50">
    </div>
  </div>

  <audio id="rollSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_206cb78e60.mp3?filename=pop-94319.mp3"></audio>

  <script>
    let vocabDict = {};
    let vocabWords = [];
    let rollingInterval = null;
    let rolling = { number: false, word: false };

    function playSound() {
      const sound = document.getElementById("rollSound");
      sound.currentTime = 0;
      sound.play();
    }

    function toggleRoll(type) {
      if (rolling[type]) {
        clearInterval(rollingInterval);
        rolling[type] = false;
        return;
      }

      if (type === 'word' && vocabWords.length === 0) {
        alert("请先选择词库。");
        return;
      }

      const speed = document.getElementById("speed").value;
      const delay = 200 - speed * 1.8;

      rolling[type] = true;
      rollingInterval = setInterval(() => {
        playSound();

        if (type === 'number') {
          const min = parseInt(document.getElementById("minNum").value);
          const max = parseInt(document.getElementById("maxNum").value);
          const student = Math.floor(Math.random() * (max - min + 1)) + min;
          document.getElementById("studentNumber").innerText = student.toString().padStart(3, '0');
        } else if (type === 'word') {
          const word = vocabWords[Math.floor(Math.random() * vocabWords.length)];
          document.getElementById("vocabWord").innerText = word;
          document.getElementById("vocabMeaning").innerText = "点击下方按钮显示中文意思";
        }
      }, delay);
    }

    function showMeaning() {
      const word = document.getElementById("vocabWord").innerText;
      const meaning = vocabDict[word] || "（暂无词义）";
      document.getElementById("vocabMeaning").innerText = word + "：" + meaning;
    }

    function loadSelectedWordFile() {
      const selected = document.getElementById("vocabSelect").value;
      if (!selected) return;

      fetch("words/" + selected)
        .then(res => res.json())
        .then(data => {
          vocabDict = data;
          vocabWords = Object.keys(data);
          alert("词库加载成功，共 " + vocabWords.length + " 个单词。");
        })
        .catch(() => {
          alert("加载词库失败，请检查文件是否存在或格式是否正确。");
        });
    }

    function loadWordFileList() {
    fetch("words/index.json")
    .then(res => res.json())
    .then(files => {
      const select = document.getElementById("vocabSelect");
      files.forEach(file => {
        const option = document.createElement("option");
        option.value = file; // 选项的值依然是完整的文件名，用于后续加载
        // 去除 .json 后缀并设置为显示文本
        option.innerText = file.replace('.json', '');
        select.appendChild(option);
      });
    })
    .catch(() => {
      alert("无法读取词库列表 index.json。请确认文件存在并格式正确。");
    });
}

    window.onload = loadWordFileList;
  </script>
</body>
</html>
