<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>肥牛老师课堂随机抽查</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'KaiTi', serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #000;
      text-align: center;
    }

    h1 {
      font-size: 48px;
      margin-top: 20px;
      font-family: "KaiTi", serif;
      color: black;
    }

    .roller-container {
      margin: 40px auto;
      width: 60%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 64px;
      font-weight: bold;
    }

    .boxed {
      background-color: rgba(255, 255, 255, 0.8);
      border: 3px solid #333;
      border-radius: 15px;
      padding: 20px 40px;
    }

    .student-number {
      flex: 4;
      text-align: right;
      padding-right: 20px;
    }

    .vocab-word {
      flex: 6;
      text-align: left;
      padding-left: 20px;
    }

    .controls {
      margin-top: 40px;
    }

    button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
    }

    input[type=range], input[type=number] {
      width: 300px;
      margin-left: 20px;
    }

    #vocabMeaning {
      margin-top: 20px;
      font-size: 28px;
      font-weight: normal;
      color: #333;
    }

    #fileInput {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>肥牛老师课堂随机抽查</h1>
  <div class="roller-container">
    <div class="student-number boxed" id="studentNumber">001</div>
    <div class="vocab-word boxed" id="vocabWord">-</div>
  </div>
  <div id="vocabMeaning">点击下方按钮显示中文意思</div>

  <div id="fileInput">
    <label>选择单词 JSON 文件：</label>
    <input type="file" id="wordFile" accept="application/json" onchange="loadWordsFromFile(this)">
  </div>

  <div class="controls">
    <div>
      <label>学号范围：</label>
      <input type="number" id="minNum" value="1" min="1" max="999"> 到
      <input type="number" id="maxNum" value="50" min="1" max="999">
    </div>
    <div>
      <button onclick="toggleRoll('number')">随机学号</button>
      <button onclick="toggleRoll('word')">随机单词</button>
      <button onclick="showMeaning()">显示中文意思</button>
    </div>
    <div>
      <label for="speed">滚动速度：</label>
      <input type="range" id="speed" min="1" max="100" value="50">
    </div>
  </div>

  <audio id="rollSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_206cb78e60.mp3?filename=pop-94319.mp3"></audio>

  <script>
    let vocabDict = {};
    let vocabWords = [];
    let rollingInterval = null;
    let rolling = { number: false, word: false };

    function playSound() {
      const sound = document.getElementById("rollSound");
      sound.currentTime = 0;
      sound.play();
    }

    function toggleRoll(type) {
      if (rolling[type]) {
        clearInterval(rollingInterval);
        rolling[type] = false;
        return;
      }

      if (type === 'word' && vocabWords.length === 0) {
        alert("请先选择并加载单词 JSON 文件。");
        return;
      }

      const speed = document.getElementById("speed").value;
      const delay = 200 - speed * 1.8;

      rolling[type] = true;
      rollingInterval = setInterval(() => {
        playSound();

        if (type === 'number') {
          const min = parseInt(document.getElementById("minNum").value);
          const max = parseInt(document.getElementById("maxNum").value);
          const student = Math.floor(Math.random() * (max - min + 1)) + min;
          document.getElementById("studentNumber").innerText = student.toString().padStart(3, '0');
        } else if (type === 'word') {
          const word = vocabWords[Math.floor(Math.random() * vocabWords.length)];
          document.getElementById("vocabWord").innerText = word;
          document.getElementById("vocabMeaning").innerText = "点击下方按钮显示中文意思";
        }
      }, delay);
    }

    function showMeaning() {
      const word = document.getElementById("vocabWord").innerText;
      const meaning = vocabDict[word] || "（暂无词义）";
      document.getElementById("vocabMeaning").innerText = word + "：" + meaning;
    }

    function loadWordsFromFile(input) {
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          vocabDict = JSON.parse(e.target.result);
          vocabWords = Object.keys(vocabDict);
          alert("单词文件加载成功，包含 " + vocabWords.length + " 个单词。");
        } catch (err) {
          alert("单词文件格式错误，请确保是有效的 JSON 格式。");
        }
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
